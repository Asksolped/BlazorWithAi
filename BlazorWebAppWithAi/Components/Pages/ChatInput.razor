@page "/ChatInput"
@using System.Text
@using System.Text.Json
@using BlazorWebAppWithAi.Models.Ollama
@inject IHttpClientFactory ClientFactory;

<h3>ChatInput</h3>
<EditForm FormName="ChatPrompt" Model="@_formData" OnSubmit="@HandleValidSubmit">
    <label for="prompt">Type your prompt...</label>
    <InputText id="prompt" @bind-Value="_formData.Prompt" type="text"></InputText>
    <button type="submit">Submit Prompt</button>
</EditForm>

<p>Ollama Response: @_ollamaResponse</p>
@code {
    private readonly OllamaRequest _formData = new();
    private string _ollamaResponse = string.Empty;

    private async Task HandleValidSubmit()
    {
        var client = ClientFactory.CreateClient();
        var content = new StringContent(JsonSerializer.Serialize(_formData), Encoding.UTF8, "application/json");
        var response = await client.PostAsync(new Uri("http://localhost:11434/api/generate"), content);
        var chatResponse = await response.Content.ReadFromJsonAsync<OllamaResponse>();
        if (chatResponse is null) return;
        _ollamaResponse = chatResponse.Response;
    }
}